<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>Dual Map Viewer - Final (Mobile Responsive)</title>  
  <link rel="icon" type="image/x-icon" href="https://parkstery.github.io/map/images/favicon.ico"> 
  <!-- Î∑∞Ìè¨Ìä∏ ÏÑ§Ï†ï: Î™®Î∞îÏùº ÌôïÎåÄ/Ï∂ïÏÜå Î∞©ÏßÄ Î∞è ÌÑ∞Ïπò ÏµúÏ†ÅÌôî -->
  <!--  -->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />

  <style>
    html,body{margin:0;height:100%;font-family:Arial;overflow:hidden;}
    
    /* [ÏàòÏ†ï] Ìå®ÎÑê Ïïà ÏΩòÌä∏Î°§ ÏÇ¨Ïù¥ Í∞ÑÍ≤© ÏµúÏÜåÌôî (gap: 4px) */
    #controls{
        display:flex; gap:4px; padding:6px; background:#222; color:#fff; 
        align-items:center; flex-wrap:wrap; border-bottom:1px solid #444;
        /* Î™®Î∞îÏùºÏóêÏÑú Ïª®Ìä∏Î°§ Ìå®ÎÑêÏù¥ ÎÑàÎ¨¥ Ïª§ÏßÄÏßÄ ÏïäÎèÑÎ°ù ÏÑ§Ï†ï */
        min-height: 46px; box-sizing: border-box;
    }
    
    /* Í≤ÄÏÉâÏ∞Ω Í∑∏Î£π ÎûòÌçº */
    .search-group { position: relative; display: flex; gap: 2px; align-items: center; }
    
    /* [ÏöîÍµ¨ÏÇ¨Ìï≠] searchinput width 150px (Í∏∞Î≥∏) */
    #searchInput{
        width:150px; padding:6px; font-size: 14px; font-family: Arial, sans-serif;
        border: 1px solid #ccc; border-radius: 3px;
    }
    
    /* [ÏöîÍµ¨ÏÇ¨Ìï≠] ÌûàÏä§ÌÜ†Î¶¨ ÌåùÏóÖ ÏúÑÏπò Ï°∞Ï†ï */

    #suggestList {
      position: absolute; top: 38px; 
      left: 6px; /* Ìå®ÎÑê Ï¢åÏ∏°(padding Í≥†Î†§)Ïóê ÎßûÏ∂§ */
      width: 180px; max-height: 400px; 
      overflow-y: auto; background: #fff; border: 1px solid #888; z-index: 2000; display: none;
    }
    #historySelect { 
        display: none; position: absolute; top: 38px; 
        left: 186px; /* suggestList Ï¢åÏ∏°(6) + ÎÑàÎπÑ(180)Ïóê ÎßûÏ∂§ */
        width: 150px; max-height: 200px; padding: 4px; 
        font-size: 14px; z-index: 2001; border: 1px solid #888; 
        background: #fff; color: #333; box-shadow: 2px 2px 5px rgba(0,0,0,0.3);
    }
    #container{
        display:flex; 
        /* Í∏∞Î≥∏: Í∞ÄÎ°ú Î∞∞Ïπò */
        flex-direction: row; 
        width: 100%;
        height:calc(100% - 46px);
    }
    
    .map{
        flex:1; position:relative; 
        border-right: 1px solid #444; border-bottom: none;
    }
    .map:last-child{border-right:none; border-bottom:none;}

    /* Padlet ÎßÅÌÅ¨ (Ïö∞Ï∏° Ï†ïÎ†¨) */
    .padlet-link {
        margin-left: auto; 
        color: #4DC4FF; text-decoration: none;
        font-size: 13px; font-weight: bold;
        padding: 3px 2px; border: 1px solid #4DC4FF;
        border-radius: 4px; transition: all 0.3s;
        white-space: nowrap;
    }
    .padlet-link:hover { background: #4DC4FF; color: #fff; }

    /* ÏûêÎèôÏôÑÏÑ± */

    #suggestList div{padding:8px 10px; border-bottom:1px solid #eee; cursor:pointer; color:black; font-size: 14px;}
    #suggestList div:hover, #suggestList div.active{background:#cce5ff;}

    /* [ÏöîÍµ¨ÏÇ¨Ìï≠] leftType, rightType width 28px */
    #leftType, #rightType { 
      padding: 0; font-size: 14px;
      height: 28px; width: 24px;
      cursor: pointer; background: #fff;
      border: 1px solid #ccc; border-radius: 3px;
      display: flex; align-items: center; justify-content: center;
    }
    #leftType img, #rightType img { width: 20px; height: 20px; object-fit: contain; }

    select#leftSelect, select#rightSelect { width: 60px; height: 28px; font-size: 13px; border-radius: 3px; }
    
    #clearSearchBtn { 
        padding: 0; height: 29px; width: 24px;
        cursor: pointer; background: #fff;
        border: 1px solid #ccc; border-radius: 3px;
        display: flex; align-items: center; justify-content: center;
    }
    #clearSearchBtn img { width: 18px; height: 28px; object-fit: contain; }

    /* ÎØ∏ÎãàÎßµ Ïä§ÌÉÄÏùº */
    .minimap-style {
      position: absolute !important;
      width: 25% !important; height: 25% !important;
      min-width: 250px; min-height: 200px;
      top: auto !important; bottom: 0; left: 0;
      z-index: 20; border-top: 1px solid #888; border-right: 1px solid #888;
      box-shadow: 2px -2px 5px rgba(0,0,0,0.3);
    }

    .close-btn-style {
      position:absolute; top:10px; right:10px; z-index: 10001; 
      padding:5px 10px; background:#fff; color:#333;
      border:1px solid #ccc; cursor:pointer; border-radius:3px;
      font-weight:bold; font-size: 12px; display:none; 
    }

    .street-btn-style {
      position:absolute; top:10px; right:10px; z-index:30;
      padding:5px 10px; background:#fff; border:1px solid #ccc;
      cursor:pointer; border-radius:3px; font-weight:bold; font-size:12px;
      color:#333;
    }

    .kakao-toolbar{
      position:absolute; top:5px; right:40px; z-index:30;
      background:white; border-radius:5px;
      box-shadow:0 2px 6px rgba(0,0,0,0.3);
      display:flex; overflow:hidden;
    }
    .kakao-toolbar button{
      background:#fff; border:0; border-right:1px solid #ddd;
      width: 36px; height: 32px; cursor:pointer;
      display: flex; align-items: center; justify-content: center;
    }
    .kakao-toolbar button:last-child{border-right:none;}
    .kakao-toolbar button.active{background:#3396ff;}
    .kakao-toolbar button.active img { filter: invert(100%); }
    .kakao-toolbar button img { width: 18px; height: 18px; }

    .roadview-status {
      position:absolute; top:10px; left:10px; z-index:30;
      background:rgba(0,0,0,0.7); color:white; padding:8px 12px;
      border-radius:4px; font-size:13px; font-weight:bold;
    }

    .info-overlay{
      background:white; border:1px solid #333; border-radius:4px;
      padding:10px; font-size:12px; box-shadow:2px 2px 5px rgba(0,0,0,0.3);
    }
    .measure-label{
      background:#fff; padding:3px 6px; border:1px solid #888;
      border-radius:3px; font-size:11px; color:#333;
    }

    .MapWalker{ position:absolute; width:24px; height:24px; margin:-12px 0 0 -12px; pointer-events:none; }
    .MapWalker .angleBack{
      position:absolute; top:50%; left:50%; width:0; height:0;
      border-left:20px solid transparent; border-right:20px solid transparent;
      border-top:40px solid rgba(51,150,255,0.4);
      transform-origin:center bottom; margin-left:-20px; margin-top:-40px;
    }
    .MapWalker .figure{
      position:absolute; top:50%; left:50%; width:0; height:0;
      border-left:8px solid transparent; border-right:8px solid transparent;
      border-bottom:16px solid #ff3300;
      transform-origin:center center; margin-left:-8px; margin-top:-8px;
    }
    .naver-marker-arrow {
      width: 0; height: 0;
      border-left: 10px solid transparent; border-right: 10px solid transparent;
      border-bottom: 24px solid #4DC4FF;
      transform-origin: center center;
    }

    /* ==========================================================================
       [Î™®Î∞îÏùº Î∞òÏùëÌòï CSS] 
       - ÌôîÎ©¥ ÎÑàÎπÑ 768px Ïù¥ÌïòÏùº Îïå Ï†ÅÏö©
       - Îßµ Î∞∞Ïπò ÏÉÅÌïò(Column)Î°ú Î≥ÄÍ≤Ω
       - UI ÏöîÏÜå ÌÅ¨Í∏∞ Î∞è Î∞∞Ïπò ÏµúÏ†ÅÌôî 
       ========================================================================== */
 
/* === [Î™®Î∞îÏùº ÏµúÏ†ÅÌôî (Mobile Responsive)] === */
    @media (max-width: 768px) {
        #container { 
            flex-direction: column; 
            /* height auto ÎåÄÏã† Î™ÖÌôïÌïú Í∞í Î∂ÄÏó¨ */
            height: calc(100dvh - 100px); /* 100dvh ÏÇ¨Ïö© */
            min-height: 0;
        }      
     
/* [ÏàòÏ†ï] Î™®Î∞îÏùº Îßµ Ïä§ÌÉÄÏùº */
        .map { 
            border-right: none; 
            border-bottom: 1px solid #444; 
            width: 100%;
            height: 50%; 
            flex: 1 1 auto;
            
            /* [ÌïµÏã¨] Î°úÎî© ÌÉÄÏù¥Î∞ç Î¨∏Ï†úÎ°ú ÎÜíÏù¥Í∞Ä 0Ïù¥ ÎêòÎäî Í≤ÉÏùÑ Î∞©ÏßÄÌïòÍ∏∞ ÏúÑÌï¥ ÏµúÏÜå ÎÜíÏù¥ Í∞ïÏ†ú ÏÑ§Ï†ï */
            min-height: 300px; 
        }        
        /* [ÏàòÏ†ï] z-index Î™ÖÏãú */
        #controls { 
            padding: 1px; gap: 4px; justify-content: space-between; 
            z-index: 2000; /* ÎßµÎ≥¥Îã§ ÏúÑÏóê ÏúÑÏπò */
            position: relative;
        }
        
        /* Í≤ÄÏÉâÏ∞Ω ÎÑàÎπÑ Ï∂ïÏÜå */
        /* #searchInput { width: 110px; font-size: 13px; } */
        #searchInput { width: 100px; height: 16px; font-size: 13px; padding: 5px; }
        /* ÏÑ†ÌÉùÎ∞ïÏä§ Í∏ÄÏûê ÌÅ¨Í∏∞ Ï°∞Ï†ï */
        select#leftSelect, select#rightSelect { width: 60px; font-size: 12px; }
                
        /* ÎßÅÌÅ¨ Î≤ÑÌäº Í∏ÄÏûê ÌÅ¨Í∏∞ Ï°∞Ï†ï */
        .padlet-link { font-size: 12px; }

        /* Î™®Î∞îÏùºÏóêÏÑú ÎØ∏ÎãàÎßµ ÌÅ¨Í∏∞ Ï°∞Ï†ï (ÌôîÎ©¥ÏùÑ ÎÑàÎ¨¥ Í∞ÄÎ¶¨ÏßÄ ÏïäÍ≤å) */

        .minimap-style {
            width: 40% !important; height: 35% !important;
            min-width: 140px; min-height: 110px;
            bottom: 5px; left: 5px;
        }        
    


        /* [ÌïµÏã¨ ÏàòÏ†ï] ÌûàÏä§ÌÜ†Î¶¨ ÌåùÏóÖ: fixedÎ°ú Î≥ÄÍ≤ΩÌïòÏó¨ Îßµ ÏúÑÎ°ú Í∞ïÏ†ú Î∂ÄÏñë */
        #historySelect { 
            display: none;
            position: fixed; /* absolute -> fixed */
            left: 185px; 
            top: 50px;       /* Ïª®Ìä∏Î°§ Ìå®ÎÑê ÎÜíÏù¥(ÏïΩ 46px) + Ïó¨Î∞± */
            
            width: 150px; 
            height: auto; max-height: 200px;
            padding: 4px; font-size: 14px; 
            z-index: 10001; /* Îßµ Î†àÏù¥Ïñ¥Î≥¥Îã§ ÌôïÏã§Ìûà ÎÜíÍ≤å ÏÑ§Ï†ï */
            border: 1px solid #888;
            background: #fff; color: #333;
            box-shadow: 2px 2px 10px rgba(0,0,0,0.5); /* Í∑∏Î¶ºÏûê ÏßÑÌïòÍ≤å */
        }

        /* [ÌïµÏã¨ ÏàòÏ†ï] Ï∂îÏ≤ú Î¶¨Ïä§Ìä∏: fixedÎ°ú Î≥ÄÍ≤Ω */
        #suggestList {
            position: fixed; /* absolute -> fixed */
            top: 50px;       /* Ïª®Ìä∏Î°§ Ìå®ÎÑê ÎÜíÏù¥ + Ïó¨Î∞± */
            left: 10px;      /* ÌôîÎ©¥ ÏôºÏ™ΩÏóêÏÑú ÏïΩÍ∞Ñ ÎùÑÏõÄ */
            width: 170px;    /* Î™®Î∞îÏùº ÌôîÎ©¥ Í≥†Î†§ÌïòÏó¨ ÎÑàÎπÑ Ï°∞Ï†ï */
            
            max-height: 500px; overflow-y: auto; background: #fff;
            border: 1px solid #888; 
            z-index: 10001; /* Îßµ ÏúÑÎ°ú Í∞ïÏ†ú Î∂ÄÏñë */
            box-shadow: 2px 2px 10px rgba(0,0,0,0.5);
        }
    }    
  </style>
<!--  -->
  <!-- SDKs -->
  <script src="https://dapi.kakao.com/v2/maps/sdk.js?appkey=8d2d116d6a534a98e73133808f5843a6&libraries=services,drawing,clusterer"></script>
  <script src="https://oapi.map.naver.com/openapi/v3/maps.js?ncpKeyId=a4kf3r53du&submodules=panorama"></script>
  <script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBYXu5yKdW71VuKmI-N2M2xbvMaYTK2HCg&callback=init"></script>
</head>

<body>
<div id="controls">
  <!-- [ÏöîÍµ¨ÏÇ¨Ìï≠] ÏÉÅÎã® Ìå®ÎÑê Ïª®Ìä∏Î°§ ÏúÑÏπò Î≥ÄÍ≤Ω -->
  <!-- Left -->
  <select id="leftSelect"><option value="google">Google</option><option value="kakao">Kakao</option><option value="naver">Naver</option></select>
  <button id="leftType" title="ÏßÄÎèÑ/ÏúÑÏÑ±"><img src="images/satellite_img.png" alt="MapType"></button>

  <!-- Search Group -->
  <div class="search-group">
      <input id="searchInput" placeholder="Ï£ºÏÜå ÎòêÎäî ÏßÄÎ™Ö ÏûÖÎ†•" autocomplete="off"/>
      <button id="clearSearchBtn" title="ÏßÄÏö∞Í∏∞"><img src="images/map_trash20.jpg" alt="Clear"></button>
      
      <select id="historySelect" size="5"><option value="">ÏµúÍ∑º Í≤ÄÏÉâ Í∏∞Î°ù</option></select>
      <div id="suggestList"></div>
  </div>

  <!-- Right -->
  <select id="rightSelect"><option value="google">Google</option><option value="kakao" selected>Kakao</option><option value="naver">Naver</option></select>
  <button id="rightType" title="ÏßÄÎèÑ/ÏúÑÏÑ±"><img src="images/map_img.png" alt="MapType"></button>

  <!-- Padlet -->
  <a href="https://padlet.com/googiden/padlet-qr93paqb7efcunwe" target="_blank" class="padlet-link">!! &gt;</a>
</div>

<div id="container">
  <div id="leftMap" class="map"></div>
  <div id="rightMap" class="map"></div>
</div>

<script>
/* ===== ÏÉÅÌÉú Í¥ÄÎ¶¨ (v1.9 Î°úÏßÅ ÏôÑÏ†Ñ Î≥¥Ï°¥) ===== */
let syncing = false;
let rvSyncing = false; 
let state = { lat: 37.5665, lng: 126.9780, zoom: 13 };

let left = { 
  type: "google", map: null, satellite: true, 
  panorama: null, roadviewActive: false,
  gis: createGisState(),
  naverState: { active: false, streetLayer: null, marker: null },
  searchMarker: null
};
let right = { 
  type: "kakao", map: null, satellite: false, 
  panorama: null, roadviewActive: false,
  gis: createGisState(),
  naverState: { active: false, streetLayer: null, marker: null },
  searchMarker: null
};

let searchHistory = JSON.parse(localStorage.getItem('mapSearchHistory')) || [];
let kakaoSearchMarker = null; 
let activeSuggestIndex = -1;
let kakaoGeocoder = null;
let kakaoPs = null;
let kakaoRvClient = null; 

function createGisState() {
  return { mode: 'default', waiting: false, drawing: null, path: [], overlays: [], shapes: [], markers: [], walker: null, statusEl: null };
}

function init(){
  if(typeof kakao !== 'undefined' && kakao.maps && kakao.maps.services){
    kakaoGeocoder = new kakao.maps.services.Geocoder();
    kakaoPs = new kakao.maps.services.Places();
    kakaoRvClient = new kakao.maps.RoadviewClient();
  }
  leftSelect.value = left.type; 
  rightSelect.value = right.type;
  bindUI();
  createMaps();
  renderHistory();

  // [Ï§ëÏöî] Î™®Î∞îÏùº Ï¥àÍ∏∞ Î°úÎî© Ïãú Î†àÏù¥ÏïÑÏõÉ Íπ®Ïßê Î∞©ÏßÄÏö© Í∞ïÏ†ú Î¶¨Î†àÏù¥ÏïÑÏõÉ Ïã§Ìñâ
  setTimeout(forceMapRelayout, 500); 
}

/* [Ï∂îÍ∞Ä] Î™®Î∞îÏùº ÏÉàÎ°úÍ≥†Ïπ® Ïãú Îπà ÌôîÎ©¥ Î∞©ÏßÄÎ•º ÏúÑÌïú ÏïàÏ†ÑÏû•Ïπò */
window.addEventListener('load', () => {
    // ÌéòÏù¥ÏßÄÏùò Î™®Îì† Î¶¨ÏÜåÏä§(CSS, Ïù¥ÎØ∏ÏßÄ Îì±)Í∞Ä Î°úÎìúÎêú ÌõÑ Ïã§Ìñâ
    setTimeout(() => {
        forceMapRelayout(); // 1Ï∞® Í∞ïÏ†ú Î¶¨Î†àÏù¥ÏïÑÏõÉ
    }, 100);

    setTimeout(() => {
        forceMapRelayout(); // 2Ï∞® Í∞ïÏ†ú Î¶¨Î†àÏù¥ÏïÑÏõÉ (ÎäêÎ¶∞ ÎÑ§Ìä∏ÏõåÌÅ¨ ÎåÄÎπÑ)
    }, 1000);
});
  

// [Ï∂îÍ∞Ä] Î™®Î∞îÏùº ÌöåÏ†Ñ/Î¶¨ÏÇ¨Ïù¥Ï¶à ÎåÄÏùë Ìï®Ïàò
window.addEventListener('resize', () => {
    // 0.1Ï¥à Îí§Ïóê Îßµ ÏÇ¨Ïù¥Ï¶àÎ•º Îã§Ïãú Í≥ÑÏÇ∞ÌïòÎèÑÎ°ù Í∞ïÏ†úÌï®
    setTimeout(forceMapRelayout, 100);
});

// [Ï∂îÍ∞Ä] 3ÏÇ¨ Îßµ API Î¶¨Î†àÏù¥ÏïÑÏõÉ(Resize) Í∞ïÏ†ú Ïã§Ìñâ Ìï®Ïàò
function forceMapRelayout() {
    [left, right].forEach(side => {
        if(!side.map) return;
        if(side.type === 'kakao') {
            side.map.relayout();
            side.map.setCenter(new kakao.maps.LatLng(state.lat, state.lng));
        } else if(side.type === 'google') {
            google.maps.event.trigger(side.map, "resize");
            side.map.setCenter(state);
        } else if(side.type === 'naver') {
            // ÎÑ§Ïù¥Î≤ÑÎäî window resize Ïù¥Î≤§Ìä∏Î•º ÏûêÎèôÏúºÎ°ú Í∞êÏßÄÌïòÏßÄÎßå Î™ÖÏãúÏ†ÅÏúºÎ°ú Ï≤òÎ¶¨
            side.map.setSize(new naver.maps.Size(side.map.getElement().offsetWidth, side.map.getElement().offsetHeight));
            side.map.setCenter(new naver.maps.LatLng(state.lat, state.lng));
        }
    });
}

function createMaps(){
  createMap(left, "leftMap");
  createMap(right, "rightMap");
  bindEvents(left, right);
  bindEvents(right, left);
  bindRoadviewSync();
  setTimeout(forceMapRelayout, 200); // Îßµ ÏÉùÏÑ± ÌõÑ Ï¶âÏãú Î¶¨Î†àÏù¥ÏïÑÏõÉ
}

function createMap(side, containerId) {
  const el = document.getElementById(containerId);
  el.innerHTML = ""; 
  
  if(side.map) {
    if(side.type === "naver" && side.map.destroy) side.map.destroy();
    side.map = null; side.panorama = null; side.roadviewActive = false;
    side.gis = createGisState(); side.naverState = { active: false, streetLayer: null, marker: null };
    side.searchMarker = null;
  }

  // GOOGLE
  if(side.type === "google") {
    const mapInner = document.createElement("div");
    mapInner.style.width = "100%"; mapInner.style.height = "100%";
    el.appendChild(mapInner);
    const panoDiv = document.createElement("div");
    panoDiv.style.cssText = "position:absolute;top:0;left:0;width:100%;height:100%;z-index:15;display:none;";
    el.appendChild(panoDiv);
    const closeBtn = document.createElement("div");
    closeBtn.className = "close-btn-style";
    closeBtn.innerHTML = "Street Îã´Í∏∞ X"; 
    el.appendChild(closeBtn);

    const map = new google.maps.Map(mapInner, {
      center: state, zoom: state.zoom, mapTypeId: side.satellite ? "satellite" : "roadmap",
      maxZoom: 21, zoomControl: false, streetViewControl: true,
      streetViewControlOptions: { position: google.maps.ControlPosition.TOP_RIGHT }
    });

    const coverageLayer = new google.maps.StreetViewCoverageLayer();
    const panorama = new google.maps.StreetViewPanorama(panoDiv, {
      enableCloseButton: false, visible: false, zoom: 1, pov: { heading: 0, pitch: 0 }
    });
    map.setStreetView(panorama);
    side.panorama = panorama;

    panorama.addListener("visible_changed", () => {
      if (panorama.getVisible()) {
        side.roadviewActive = true; panoDiv.style.display = "block"; closeBtn.style.display = "block";
        mapInner.classList.add("minimap-style"); coverageLayer.setMap(map);
        google.maps.event.trigger(map, "resize");
        setTimeout(() => map.setCenter(panorama.getPosition()), 50);
      } else {
        side.roadviewActive = false; panoDiv.style.display = "none"; closeBtn.style.display = "none";
        mapInner.classList.remove("minimap-style"); coverageLayer.setMap(null);
      }
      google.maps.event.trigger(map, "resize");
    });
    panorama.addListener("position_changed", () => { if(side.roadviewActive) map.setCenter(panorama.getPosition()); });
    closeBtn.onclick = () => panorama.setVisible(false);
    side.map = map;
  }
  // KAKAO
  else if(side.type === "kakao") {
    const wrapper = document.createElement("div");
    wrapper.style.cssText = "position:relative;width:100%;height:100%;";
    const rvDiv = document.createElement("div");
    rvDiv.style.cssText = "position:absolute;top:0;left:0;width:100%;height:100%;background:#333;z-index:5;display:none;";
    const mapDiv = document.createElement("div");
    mapDiv.style.cssText = "position:absolute;top:0;left:0;width:100%;height:100%;z-index:10;background:#eee;";
    const closeBtn = document.createElement("div");
    closeBtn.className = "close-btn-style";
    closeBtn.innerHTML = "Î°úÎìúÎ∑∞ Îã´Í∏∞ X";
    closeBtn.onclick = () => closeKakaoRoadview(side, rvDiv, mapDiv, closeBtn);

    const toolbar = document.createElement("div");
    toolbar.className = "kakao-toolbar";
    const btnData = [
      { id: 'roadview', text: 'Î°úÎìúÎ∑∞', img: './images/map_roadview20.jpg', action: () => toggleKakaoMode(side, 'roadview', wrapper) },
      { id: 'district', text: 'ÏßÄÏ†ÅÎèÑ', img: './images/map_cada20.jpg', action: () => toggleKakaoOverlay(side, 'district') },
      { id: 'distance', text: 'Í±∞Î¶¨', img: './images/map_scale20.jpg', action: () => toggleKakaoMode(side, 'distance', wrapper) },
      { id: 'area', text: 'Î©¥Ï†Å', img: './images/map_area20.jpg', action: () => toggleKakaoMode(side, 'area', wrapper) },
      { id: 'clear', text: 'Ï¥àÍ∏∞Ìôî', img: './images/map_trash20.jpg', class: 'delete-btn', action: () => clearKakaoMeasurements(side) }
    ];
    btnData.forEach(bd => {
      const btn = document.createElement("button");
      const img = document.createElement("img"); img.src = bd.img; btn.appendChild(img);
      btn.title = bd.text; btn.setAttribute('data-mode', bd.id); btn.onclick = bd.action;
      toolbar.appendChild(btn);
    });

    mapDiv.appendChild(toolbar); wrapper.appendChild(rvDiv); wrapper.appendChild(closeBtn); wrapper.appendChild(mapDiv);
    el.appendChild(wrapper);

    const map = new kakao.maps.Map(mapDiv, {
      center: new kakao.maps.LatLng(state.lat, state.lng), level: zoomToKakao(state.zoom)
    });
    map.setMapTypeId(side.satellite ? kakao.maps.MapTypeId.HYBRID : kakao.maps.MapTypeId.ROADMAP);
    map.addControl(new kakao.maps.ZoomControl(), kakao.maps.ControlPosition.RIGHT);
    const rv = new kakao.maps.Roadview(rvDiv); side.panorama = rv; 

    kakao.maps.event.addListener(map, 'click', (e) => onKakaoMapClick(side, e, rvDiv, mapDiv, closeBtn));
    kakao.maps.event.addListener(map, 'mousemove', (e) => onKakaoMapMouseMove(side, e));
    kakao.maps.event.addListener(map, 'rightclick', (e) => onKakaoMapRightClick(side, e));
    kakao.maps.event.addListener(rv, 'position_changed', () => {
      if (!side.roadviewActive) return; 
      const pos = rv.getPosition();
      if(side.gis.walker) side.gis.walker.setPosition(pos);
      else side.gis.walker = new kakao.maps.CustomOverlay({ position: pos, content: createWalkerContent(0), map: side.map });
      map.setCenter(pos);
    });
    kakao.maps.event.addListener(rv, 'viewpoint_changed', () => {
      if (side.roadviewActive && side.gis.walker) side.gis.walker.setContent(createWalkerContent(rv.getViewpoint().pan));
    });
    side.map = map; side.dom = { wrapper, rvDiv, mapDiv, closeBtn, toolbar }; 
  }
  // NAVER
  else if(side.type === "naver") {
    const mapInner = document.createElement("div"); mapInner.style.width = "100%"; mapInner.style.height = "100%"; el.appendChild(mapInner);
    const panoDiv = document.createElement("div"); panoDiv.style.cssText = "position:absolute;top:0;left:0;width:100%;height:100%;z-index:15;visibility:hidden;"; el.appendChild(panoDiv);
    const closeBtn = document.createElement("div"); closeBtn.className = "close-btn-style"; closeBtn.innerHTML = "Í±∞Î¶¨Î∑∞ Îã´Í∏∞ X"; el.appendChild(closeBtn);
    const streetBtn = document.createElement("div"); streetBtn.className = "street-btn-style"; streetBtn.innerHTML = "Í±∞Î¶¨Î∑∞"; mapInner.appendChild(streetBtn);

    const map = new naver.maps.Map(mapInner, { center: new naver.maps.LatLng(state.lat, state.lng), zoom: state.zoom, maxZoom: 21 });
    const pano = new naver.maps.Panorama(panoDiv, { position: new naver.maps.LatLng(state.lat, state.lng), pov: { pan: 0, tilt: 0, fov: 100 }, visible: false });
    side.panorama = pano; const streetLayer = new naver.maps.StreetLayer(); side.naverState.streetLayer = streetLayer;
    const marker = new naver.maps.Marker({ position: map.getCenter(), map: null, icon: { content: '<div class="naver-marker-arrow"></div>', anchor: new naver.maps.Point(8, 10) } });
    side.naverState.marker = marker; 

    streetBtn.onclick = () => {
      if (side.naverState.active) { resetNaverRoadview(); } 
      else { side.naverState.active = true; streetLayer.setMap(map); streetBtn.innerHTML = "Í±∞Î¶¨Î∑∞ Ï∑®ÏÜå"; streetBtn.style.background = "#4DC4FF"; streetBtn.style.color = "white"; map.setCursor('crosshair'); }
    };
    function resetNaverRoadview() {
      side.naverState.active = false; side.roadviewActive = false; streetLayer.setMap(null); streetBtn.innerHTML = "Í±∞Î¶¨Î∑∞"; streetBtn.style.background = "#fff"; streetBtn.style.color = "#333"; streetBtn.style.display = 'block';
      pano.setVisible(false); panoDiv.style.visibility = 'hidden'; mapInner.classList.remove('minimap-style'); closeBtn.style.display = 'none'; marker.setMap(null); map.setCursor('default'); setTimeout(() => naver.maps.Event.trigger(map, 'resize'), 100);
    }
    naver.maps.Event.addListener(map, 'click', (e) => {
      if (side.naverState.active && streetLayer.getMap()) {
        const newPos = e.coord; marker.setPosition(newPos); map.setCenter(newPos); map.setZoom(18); pano.setPosition(newPos);
        if (!mapInner.classList.contains('minimap-style')) {
            side.roadviewActive = true; pano.setVisible(true); panoDiv.style.visibility = 'visible'; mapInner.classList.add('minimap-style'); closeBtn.style.display = 'block'; streetBtn.style.display = 'none'; marker.setMap(map); map.setCursor('default'); naver.maps.Event.trigger(map, 'resize');
            setTimeout(() => { map.setCenter(newPos); map.setZoom(18); streetLayer.setMap(map); }, 150);
        }
      }
    });
    naver.maps.Event.addListener(pano, 'pano_changed', () => { marker.setPosition(pano.getPosition()); map.setCenter(pano.getPosition()); });
    naver.maps.Event.addListener(pano, 'pov_changed', () => { const arrow = mapInner.querySelector('.naver-marker-arrow'); if(arrow) arrow.style.transform = `rotate(${pano.getPov().pan}deg)`; });
    closeBtn.onclick = resetNaverRoadview;
    naver.maps.Event.addListener(map, "idle", () => syncFromNaver(side));
    side.map = map;
  }
}

/* KAKAO GIS */
function toggleKakaoOverlay(side, type){
  if(type === 'district') {
    const btn = side.dom.toolbar.querySelector('button[data-mode="district"]');
    if(btn.classList.contains('active')){ side.map.removeOverlayMapTypeId(kakao.maps.MapTypeId.USE_DISTRICT); btn.classList.remove('active'); }
    else { side.map.addOverlayMapTypeId(kakao.maps.MapTypeId.USE_DISTRICT); btn.classList.add('active'); }
  }
}
function toggleKakaoMode(side, mode, wrapper){
  if(!side.map) return; stopKakaoDrawing(side); 
  if(side.gis.mode === mode) { toggleKakaoMode(side, 'default', wrapper); return; }
  const buttons = side.dom.toolbar.querySelectorAll('button');
  buttons.forEach(b => { if(b.getAttribute('data-mode') !== 'district') b.classList.remove('active'); });
  const targetBtn = side.dom.toolbar.querySelector(`button[data-mode="${mode}"]`);
  if(targetBtn) targetBtn.classList.add('active');

  if(side.gis.mode === 'roadview' && mode !== 'roadview') closeKakaoRoadview(side, side.dom.rvDiv, side.dom.mapDiv, side.dom.closeBtn);
  side.gis.mode = mode;

  if(mode === 'roadview'){
    side.map.addOverlayMapTypeId(kakao.maps.MapTypeId.ROADVIEW);
    if(!side.gis.statusEl){
      side.gis.statusEl = document.createElement('div'); side.gis.statusEl.className = 'roadview-status';
      side.gis.statusEl.innerHTML = 'üìç Î°úÎìúÎ∑∞ ÏúÑÏπòÎ•º ÌÅ¥Î¶≠ÌïòÏÑ∏Ïöî'; side.dom.mapDiv.appendChild(side.gis.statusEl);
    }
    side.map.setCursor('crosshair'); side.gis.waiting = true; side.roadviewActive = true; 
  } 
  else if (mode === 'distance' || mode === 'area') side.map.setCursor('crosshair');
  else side.map.setCursor('default');
}
function onKakaoMapClick(side, mouseEvent, rvDiv, mapDiv, closeBtn){
  const pos = mouseEvent.latLng;
  if(side.gis.mode === 'roadview') {
    if(side.gis.waiting) {
      side.map.setCursor('default'); side.gis.waiting = false;
      if(side.gis.statusEl) { side.gis.statusEl.remove(); side.gis.statusEl = null; }
      rvDiv.style.display = 'block'; closeBtn.style.display = 'block'; mapDiv.classList.add('minimap-style');
      setTimeout(() => { side.map.relayout(); side.panorama.relayout(); moveKakaoRoadview(side, pos); }, 300);
    } else { moveKakaoRoadview(side, pos); }
    return;
  }
  if(side.gis.mode === 'distance' || side.gis.mode === 'area') {
    side.gis.path.push(pos); const marker = new kakao.maps.Marker({position:pos, map:side.map}); side.gis.markers.push(marker);
    if(!side.gis.drawing) {
      if(side.gis.mode === 'distance') side.gis.drawing = new kakao.maps.Polyline({ map: side.map, path: [pos], strokeWeight:3, strokeColor:'#db4040', strokeOpacity:1, strokeStyle:'solid' });
      else side.gis.drawing = new kakao.maps.Polygon({ map: side.map, path: [pos], strokeWeight:3, strokeColor:'#39f', strokeOpacity:0.8, strokeStyle:'longdash', fillColor:'#39f', fillOpacity:0.2 });
    } else {
      side.gis.drawing.setPath(side.gis.path);
      let content = side.gis.mode === 'distance' ? `<div class="measure-label">${Math.round(side.gis.drawing.getLength()).toLocaleString()}m</div>` : (side.gis.path.length >= 3 ? `<div class="measure-label">${Math.round(side.gis.drawing.getArea()).toLocaleString()}m¬≤</div>` : '');
      if(content) { const overlay = new kakao.maps.CustomOverlay({ map: side.map, position: pos, content: content, yAnchor: 2.5 }); side.gis.overlays.push(overlay); }
    }
  }
}
function moveKakaoRoadview(side, pos) {
  kakaoRvClient.getNearestPanoId(pos, 50, (panoId) => {
    if(panoId) {
      side.panorama.setPanoId(panoId, pos);
      if(side.gis.walker) side.gis.walker.setPosition(pos);
      else if (side.roadviewActive) { side.gis.walker = new kakao.maps.CustomOverlay({ position: pos, content: createWalkerContent(0), map: side.map }); }
      map.setCenter(pos);
    }
  });
}
function onKakaoMapMouseMove(side, mouseEvent) { if(!side.gis.drawing) return; const path = side.gis.path.slice(); path.push(mouseEvent.latLng); side.gis.drawing.setPath(path); }

function onKakaoMapRightClick(side, mouseEvent) {
  // 1. Í±∞Î¶¨/Î©¥Ï†Å Ïû¨Í∏∞ Î™®ÎìúÏùº ÎïåÏùò Î°úÏßÅ (Í∏∞Ï°¥ Ïú†ÏßÄ)
  if(side.gis.mode === 'distance' || side.gis.mode === 'area') {
    if(side.gis.drawing && side.gis.path.length > 0) {
      const pos = mouseEvent.latLng;
      let content = '';
      
      if(side.gis.mode === 'distance') {
        content = `<div class="info-overlay">Ï¥ù Í±∞Î¶¨ <span style="font-weight:bold;color:#ee5555">${Math.round(side.gis.drawing.getLength()).toLocaleString()}m</span></div>`;
      } else {
        const area = Math.round(side.gis.drawing.getArea());
        content = `<div class="info-overlay">Ï¥ù Î©¥Ï†Å <span style="font-weight:bold;color:#39f">${area.toLocaleString()}m¬≤</span><br>(${Number((area*0.3025).toFixed(1)).toLocaleString()}Ìèâ)</div>`;
      }
      
      const overlay = new kakao.maps.CustomOverlay({ map: side.map, position: pos, content: content, yAnchor: 1 });
      side.gis.overlays.push(overlay);
      side.gis.shapes.push(side.gis.drawing);
      side.gis.drawing = null;
      side.gis.path = [];
    }
  } 
  // 2. [Î≥µÍµ¨Îê®] ÏùºÎ∞ò Î™®ÎìúÏùº Îïå: ÌÅ¥Î¶≠ ÏßÄÏ†ê Ï£ºÏÜå ÌëúÏãú
  else {
    const pos = mouseEvent.latLng;
    kakaoGeocoder.coord2Address(pos.getLng(), pos.getLat(), (result, status) => {
      if(status === kakao.maps.services.Status.OK && result[0]) {
        const addr = result[0].road_address ? result[0].road_address.address_name : result[0].address.address_name;
        const contentHTML = `<div style="background:white; border:1px solid #333; padding:5px 8px; border-radius:4px; font-size:12px; box-shadow:2px 2px 5px rgba(0,0,0,0.3);">üìç ${addr}</div>`;
        
        // Ïò§Î≤ÑÎ†àÏù¥ Î∞è ÎßàÏª§ ÏÉùÏÑ±
        const overlay = new kakao.maps.CustomOverlay({ map: side.map, position: pos, content: contentHTML, yAnchor: 2.2 });
        const marker = new kakao.maps.Marker({ position: pos, map: side.map });
        
        // 3Ï¥à ÌõÑ ÏûêÎèô Ï†úÍ±∞
        setTimeout(() => { 
            overlay.setMap(null); 
            marker.setMap(null); 
        }, 3000);
      }
    });
  }
}
function closeKakaoRoadview(side, rvDiv, mapDiv, closeBtn){
  side.gis.mode = 'default'; side.roadviewActive = false;
  rvDiv.style.display = 'none'; closeBtn.style.display = 'none'; mapDiv.classList.remove('minimap-style');
  side.map.removeOverlayMapTypeId(kakao.maps.MapTypeId.ROADVIEW);
  if(side.gis.walker) { side.gis.walker.setMap(null); side.gis.walker = null; }
  side.map.setCursor('default'); setTimeout(()=> side.map.relayout(), 300);
}
function clearKakaoMeasurements(side){
  side.gis.overlays.forEach(o => o.setMap(null)); side.gis.shapes.forEach(s => s.setMap(null)); side.gis.markers.forEach(m => m.setMap(null));
  if(side.searchMarker) { side.searchMarker.setMap(null); side.searchMarker = null; }
  side.gis.overlays = []; side.gis.shapes = []; side.gis.markers = [];
  stopKakaoDrawing(side); toggleKakaoMode(side, 'default', side.dom.wrapper);
}
function stopKakaoDrawing(side){ if(side.gis.drawing) { side.gis.drawing.setMap(null); side.gis.drawing = null; } side.gis.path = []; }
function createWalkerContent(angle){ return `<div class="MapWalker"><div class="angleBack" style="transform:rotate(${angle}deg);"></div><div class="figure" style="transform:rotate(${angle}deg);"></div></div>`; }

/* ROADVIEW SYNC */
function bindRoadviewSync() {
  const setupSync = (fromSide, toSide) => {
    const fromPano = fromSide.panorama; const toPano = toSide.panorama;
    const posEvent = fromSide.type === 'naver' ? 'pano_changed' : 'position_changed';
    const onPosChange = () => {
      if (rvSyncing) return;
      let lat, lng;
      if (fromSide.type === 'google' || fromSide.type === 'naver') { const p = fromPano.getPosition(); lat = p.lat(); lng = p.lng(); }
      else { const p = fromPano.getPosition(); lat = p.getLat(); lng = p.getLng(); }
      
      if (toSide.type === 'naver') { 
          const p = toPano.getPosition(); 
          const curLat = p.lat(); const curLng = p.lng(); 
          const dist = Math.abs(curLat - lat) + Math.abs(curLng - lng);
          if(dist < 0.00001) return;
      }

      rvSyncing = true;
      if (toSide.type === 'google') toPano.setPosition({ lat, lng });
      else if (toSide.type === 'naver') { const nPos = new naver.maps.LatLng(lat, lng); toPano.setPosition(nPos); toSide.map.setCenter(nPos); toSide.naverState.marker.setPosition(nPos); }
      else if (toSide.type === 'kakao') {
        kakaoRvClient.getNearestPanoId(new kakao.maps.LatLng(lat, lng), 50, (id) => {
          if (id) { 
              const np = new kakao.maps.LatLng(lat, lng); 
              toPano.setPanoId(id, np); 
              toSide.map.setCenter(np); 
              if (toSide.roadviewActive) {
                  if(toSide.gis.walker) toSide.gis.walker.setPosition(np); 
                  else toSide.gis.walker = new kakao.maps.CustomOverlay({ position: np, content: createWalkerContent(0), map: toSide.map });
              }
          }
        });
      }
      setTimeout(() => { rvSyncing = false; }, 300);
    };
    if(fromSide.type === 'kakao') kakao.maps.event.addListener(fromPano, posEvent, onPosChange);
    else if(fromSide.type === 'naver') naver.maps.Event.addListener(fromPano, posEvent, onPosChange);
    else fromPano.addListener(posEvent, onPosChange);
  };
  if(left.panorama && right.panorama) { setupSync(left, right); setupSync(right, left); }
}

/* MAP SYNC */
function bindEvents(src, target){
  const handleSync = () => {
    if(syncing || rvSyncing) return; syncing = true;
    let center, zoom;
    if(src.type === 'google') { const c = src.map.getCenter(); center = {lat: c.lat(), lng: c.lng()}; zoom = src.map.getZoom(); }
    else if(src.type === 'kakao') { const c = src.map.getCenter(); center = {lat: c.getLat(), lng: c.getLng()}; zoom = kakaoToZoom(src.map.getLevel()); }
    else if(src.type === 'naver') { const c = src.map.getCenter(); center = {lat: c.y, lng: c.x}; zoom = src.map.getZoom(); }
    state = { ...center, zoom }; applyTo(target);
    setTimeout(() => { syncing = false; }, 50);
  };
  if(src.type === 'google') { src.map.addListener('center_changed', handleSync); src.map.addListener('zoom_changed', handleSync); }
  else if(src.type === 'kakao') { kakao.maps.event.addListener(src.map, 'center_changed', handleSync); kakao.maps.event.addListener(src.map, 'zoom_changed', handleSync); }
  else if(src.type === 'naver') { naver.maps.Event.addListener(src.map, 'center_changed', handleSync); naver.maps.Event.addListener(src.map, 'zoom_changed', handleSync); naver.maps.Event.addListener(src.map, 'drag', handleSync); }
}
function syncFromNaver(side) {}
function applyTo(target){
  if(!target.map) return;
  if(target.type === "google"){ target.map.setCenter(state); target.map.setZoom(state.zoom); }
  else if(target.type === "kakao"){ target.map.setCenter(new kakao.maps.LatLng(state.lat, state.lng)); target.map.setLevel(zoomToKakao(state.zoom)); }
  else if(target.type === "naver"){ target.map.setCenter(new naver.maps.LatLng(state.lat, state.lng)); target.map.setZoom(state.zoom); }
}

function toggleType(side, btn){
  side.satellite = !side.satellite;
  const img = btn.querySelector('img');
  img.src = side.satellite ? "images/satellite_img.png" : "images/map_img.png";
  if(side.type === "google") side.map.setMapTypeId(side.satellite ? "satellite" : "roadmap");
  else if(side.type === "kakao") side.map.setMapTypeId(side.satellite ? kakao.maps.MapTypeId.HYBRID : kakao.maps.MapTypeId.ROADMAP);
  else if(side.type === "naver") side.map.setMapTypeId(side.satellite ? naver.maps.MapTypeId.SATELLITE : naver.maps.MapTypeId.NORMAL);
}

function zoomToKakao(z){ return Math.max(1, Math.min(14, 20-z)); }
function kakaoToZoom(l){ return Math.max(3, Math.min(20, 20-l)); }

/* UI & SEARCH */
function bindUI(){
  leftSelect.onchange = () => { left.type = leftSelect.value; createMaps(); };
  rightSelect.onchange = () => { right.type = rightSelect.value; createMaps(); };
  leftType.onclick = () => toggleType(left, leftType);
  rightType.onclick = () => toggleType(right, rightType);

  const input = document.getElementById("searchInput");
  const clearBtn = document.getElementById("clearSearchBtn");
  const historySelect = document.getElementById('historySelect');
  const suggestList = document.getElementById("suggestList");

  input.addEventListener('focus', () => { historySelect.style.display = 'block'; });
  document.addEventListener('click', (e) => { if (e.target !== input && e.target !== historySelect) historySelect.style.display = 'none'; });

  historySelect.addEventListener('change', function() {
    if(this.value !== "") {
      const item = searchHistory[this.value];
      moveToLocation(item.lat, item.lng);
      input.value = item.name; this.value = ""; this.style.display = 'none';
    }
  });

  const doSearch = () => { const q = input.value.trim(); if(q) searchKeyword(q); suggestList.style.display = "none"; };

  input.addEventListener("keydown", e => {
    const items = suggestList.querySelectorAll("div");
    if (suggestList.style.display === "block" && items.length > 0) {
        if (e.key === "ArrowDown") { e.preventDefault(); activeSuggestIndex = (activeSuggestIndex + 1) % items.length; updateActiveItem(items); }
        else if (e.key === "ArrowUp") { e.preventDefault(); activeSuggestIndex = (activeSuggestIndex - 1 + items.length) % items.length; updateActiveItem(items); }
        else if (e.key === "Enter") { e.preventDefault(); if (activeSuggestIndex > -1) items[activeSuggestIndex].click(); else doSearch(); }
    } else if (e.key === "Enter") doSearch();
  });

  function updateActiveItem(items) {
      items.forEach(item => item.classList.remove("active"));
      if (items[activeSuggestIndex]) { items[activeSuggestIndex].classList.add("active"); items[activeSuggestIndex].scrollIntoView({ block: "nearest" }); input.value = items[activeSuggestIndex].textContent; }
  }

  clearBtn.onclick = () => {
    input.value = "";
    [left, right].forEach(side => { if (side.searchMarker) { side.searchMarker.setMap(null); side.searchMarker = null; } });
  };
  
  input.addEventListener("input",()=>{
    const q=input.value.trim(); activeSuggestIndex = -1;
    if(!q){ suggestList.style.display="none"; return; }
    if(kakaoPs){
      kakaoPs.keywordSearch(q,(r,s)=>{
        if(s!==kakao.maps.services.Status.OK){ suggestList.style.display="none"; return; }
        suggestList.innerHTML="";
        r.slice(0,10).forEach(item => {
          const div=document.createElement("div");
          div.textContent=item.place_name+(item.road_address_name?" ("+item.road_address_name+")":"");
          div.onclick=()=>{ moveToLocation(item.y, item.x); suggestList.style.display="none"; input.value=item.place_name; addToHistory(item.place_name, item.y, item.x); };
          suggestList.appendChild(div);
        });
        suggestList.style.display="block";
      });
    }
  });
}

function moveToLocation(lat, lng) { state.lat = parseFloat(lat); state.lng = parseFloat(lng); state.zoom = 18; applyTo(left); applyTo(right); showSearchMarkers(lat, lng); }
function showSearchMarkers(lat, lng) {
  [left, right].forEach(side => {
    if(!side.map) return;
    if (side.searchMarker) side.searchMarker.setMap(null);
    let marker = null;
    if(side.type === 'google') marker = new google.maps.Marker({ position: { lat: parseFloat(lat), lng: parseFloat(lng) }, map: side.map });
    else if(side.type === 'naver') marker = new naver.maps.Marker({ position: new naver.maps.LatLng(lat, lng), map: side.map });
    else if(side.type === 'kakao') marker = new kakao.maps.Marker({ position: new kakao.maps.LatLng(lat, lng), map: side.map });
    side.searchMarker = marker;
  });
}
function addToHistory(name, lat, lng) {
  searchHistory = searchHistory.filter(i => i.name !== name);
  searchHistory.unshift({ name, lat, lng });
  if(searchHistory.length > 7) searchHistory.pop();
  localStorage.setItem('mapSearchHistory', JSON.stringify(searchHistory)); renderHistory();
}
function renderHistory() {
  const el = document.getElementById('historySelect');
  el.innerHTML = '<option value="">ÏµúÍ∑º Í≤ÄÏÉâ Í∏∞Î°ù</option>';
  searchHistory.forEach((item, idx) => {
    const opt = document.createElement('option');
    opt.value = idx; opt.text = item.name; el.appendChild(opt);
  });
}
function searchKeyword(q){
  kakaoGeocoder.addressSearch(q, (res, status) => {
    if(status === kakao.maps.services.Status.OK) { moveToLocation(res[0].y, res[0].x); addToHistory(res[0].address_name, res[0].y, res[0].x); }
    else {
      kakaoPs.keywordSearch(q, (r, s) => {
        if(s === kakao.maps.services.Status.OK) { moveToLocation(r[0].y, r[0].x); addToHistory(r[0].place_name, r[0].y, r[0].x); }
      });
    }
  });
}
</script>
</body>
</html>


